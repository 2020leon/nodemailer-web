<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.18.1" />
    <meta name="description" content="Nodemailer is a module for Node.js to send emails">
<meta name="author" content="Andris Reinman">

    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    
    <title>SES transport</title>
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/css/horsey.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/hugo-theme.css" rel="stylesheet">
    <script src="/js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/transports/ses/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
  <img src="/nm_logo_200x136.png" alt="Nodemailer"/>
</a>

    </div>

    <p><a href="https://moonmail.io/?utm_source=nodemailer&amp;utm_campaign=nodemailer&amp;utm_medium=header-link">Proudly Sponsored by <b>MoonMail</b></a></p>

    
</div>


  <div class="highlightable">
      <div id="ads">
          <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=nodemailercom" id="_carbonads_js"></script>
      </div>
    <ul class="topics">
      
      
        
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
      
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/about/">
        <a href="/about/">
          <span>
            
              <b>1. </b>
            
             Nodemailer
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/about/migrate/">
              <a href="/about/migrate/">
                <span>Migration     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/about/license/">
              <a href="/about/license/">
                <span>License     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/usage/">
        <a href="/usage/">
          <span>
            
              <b>2. </b>
            
             Usage
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/usage/why-smtp/">
              <a href="/usage/why-smtp/">
                <span>SMTP? Say what?     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/usage/using-gmail/">
              <a href="/usage/using-gmail/">
                <span>Using Gmail     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/usage/bulk-mail/">
              <a href="/usage/bulk-mail/">
                <span>Delivering bulk mail     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/message/">
        <a href="/message/">
          <span>
            
              <b>3. </b>
            
             Message configuration
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/message/attachments/">
              <a href="/message/attachments/">
                <span>Attachments     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/message/alternatives/">
              <a href="/message/alternatives/">
                <span>Alternatives     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/message/addresses/">
              <a href="/message/addresses/">
                <span>Address object     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/message/calendar-events/">
              <a href="/message/calendar-events/">
                <span>Calendar events     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/message/embedded-images/">
              <a href="/message/embedded-images/">
                <span>Embedded images     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/message/list-headers/">
              <a href="/message/list-headers/">
                <span>List headers     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/message/custom-headers/">
              <a href="/message/custom-headers/">
                <span>Custom headers     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/message/custom-source/">
              <a href="/message/custom-source/">
                <span>Custom source     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/smtp/">
        <a href="/smtp/">
          <span>
            
              <b>4. </b>
            
             SMTP transport
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/smtp/envelope/">
              <a href="/smtp/envelope/">
                <span>SMTP envelope     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/smtp/pooled/">
              <a href="/smtp/pooled/">
                <span>Pooled SMTP     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/smtp/testing/">
              <a href="/smtp/testing/">
                <span>Testing SMTP     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/smtp/oauth2/">
              <a href="/smtp/oauth2/">
                <span>OAuth2     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/smtp/proxies/">
              <a href="/smtp/proxies/">
                <span>Proxy support     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/smtp/dsn/">
              <a href="/smtp/dsn/">
                <span>Delivery status notifications     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/transports/">
        <a href="/transports/">
          <span>
            
              <b>5. </b>
            
             Other transports
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/transports/sendmail/">
              <a href="/transports/sendmail/">
                <span>Sendmail transport     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/transports/ses/">
              <a href="/transports/ses/">
                <span>SES transport     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/transports/stream/">
              <a href="/transports/stream/">
                <span>Stream transport     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/plugins/">
        <a href="/plugins/">
          <span>
            
              <b>6. </b>
            
             Plugins
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/plugins/create/">
              <a href="/plugins/create/">
                <span>Create plugins     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/dkim/">
        <a href="/dkim/">
          <span>
            
              <b>7. </b>
            
             DKIM
            
           </span>
        </a>
        
      </li>
      
      
      

      
        
      
      
      

      <li class="dd-item  " data-nav-id="/extras/">
        <a href="/extras/">
          <span>
            
              <b>8. </b>
            
             Extra modules
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/extras/smtp-server/">
              <a href="/extras/smtp-server/">
                <span>SMTP Server     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/extras/smtp-connection/">
              <a href="/extras/smtp-connection/">
                <span>SMTP Connection     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/extras/mailparser/">
              <a href="/extras/mailparser/">
                <span>Mailparser     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/extras/mailcomposer/">
              <a href="/extras/mailcomposer/">
                <span>Mailcomposer     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/extras/daemons/">
              <a href="/extras/daemons/">
                <span>Node.js daemons     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      <li class="dd-item">
        <a href="https://blog.nodemailer.com">
          <span>
             <b>9. </b>
             Blog
           </span>
        </a>
      </li>
      <li class="dd-item">
          <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
         <input type="hidden" name="cmd" value="_s-xclick">
         <input type="hidden" name="hosted_button_id" value="DB26KWR2BQX5W">
         <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
         <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
         </form>
      </li>
    </ul>
    <hr>
     
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                
                  
                    
                    
                <a href="/transports/" itemprop="url"><span itemprop="title">Other transports</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                  
                
                <span itemprop="title"> SES transport</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#why-not-use-aws-sdk-directly">Why not use aws-sdk directly?</a></li>
<li><a href="#usage">Usage</a>
<ul>
<li>
<ul>
<li><a href="#message-options">Message options</a></li>
<li><a href="#response">Response</a></li>
</ul></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#examples">Examples</a>
<ul>
<li><a href="#example-1">1. Send a message using SES transport</a></li>
<li><a href="#example-2">2. Throttle messages</a></li>
<li><a href="#example-3">3. IAM policy</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>SES transport</h1>
                



<p>Nodemailer SES transport is a wrapper around <em>aws.SES</em> from the <a href="https://www.npmjs.com/package/aws-sdk">aws-sdk</a> package. SES transport is available from Nodemailer v3.1.0.</p>

<h2 id="why-not-use-aws-sdk-directly">Why not use aws-sdk directly?</h2>

<p>The SES API exposes two methods to send mail – <a href="http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/SES.html#sendEmail-property">SendEmail</a> and <a href="http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/SES.html#sendRawEmail-property">SendRawEmail</a>. While the first one is really easy to use and Nodemailer is not actualy needed, then it is also quite basic in features. For example you can&rsquo;t use attachments with <em>SendEmail</em>. On the other hand <em>SendRawEmail</em> requires you build your own MIME formatted email message which is far from being easy. And this is where Nodemailer steps in – it gives you a simple to use API while supporting even really complex scenarios like embedded images or calendar events.</p>

<p>In addition to the simple API, Nodemailer also provides rate limiting for SES out of the box. SES can tolerate short spikes but you can&rsquo;t really flush all your emails at once and expect these to be delivered. To overcome this you can set a rate limiting value and let Nodemailer handle everything – if too many messages are being delivered then Nodemailer buffers these until there is an opportunity to do the actual delivery.</p>

<h2 id="usage">Usage</h2>

<p>To use SES transport, set a <em>aws.SES</em> object as the value for <strong>SES</strong> property in Nodemailer transport options. That&rsquo;s it. You are responsible of initializing that object yourself as Nodemailer does not touch the AWS settings in any way.</p>

<ul>
<li><strong>SES</strong> – is an option that expects an instantiated <em>aws.SES</em> object (see <a href="#example-1">example #1</a>).</li>
</ul>

<p>Additional properties to use are the following:</p>

<ul>
<li><strong>sendingRate</strong> optional Number. How many messages per second is allowed to be delivered to SES</li>
<li><strong>maxConnections</strong> optional Number. How many parallel connections to allow towards SES.</li>
</ul>

<p>If you use rate or connection limiting then you can also use helper methods to detect if the sending queue is full or not. This would help to avoid buffering up too many messages.</p>

<p>Listen for the <em>&lsquo;idle&rsquo;</em> event to be notified if you can push more messages to the transporter. To explicitly check if there are free spots available use <em>isIdle()</em> method (see <a href="#example-2">example #2</a>).</p>

<h4 id="message-options">Message options</h4>

<p>When sending mail there&rsquo;s also an additional message option for setting <em>SendRawEmail</em> options</p>

<ul>
<li><strong>ses</strong> is an optional object. All keys are added to the <em>SendRawEmail</em> method options.</li>
</ul>

<h4 id="response">Response</h4>

<p>The <strong>info</strong> argument for <strong>sendMail()</strong> callback includes the following properties:</p>

<ul>
<li><strong>envelope</strong> – is an envelope object <em>{from:&lsquo;address&rsquo;, to:[&lsquo;address&rsquo;]}</em></li>
<li><strong>messageId</strong> – is the Message-ID header value. This value is derived from the response of SES API, so it differs from the Message-ID values used in logging.</li>
</ul>

<h3 id="troubleshooting">Troubleshooting</h3>

<p><strong>1. Not allowed to send messages</strong></p>

<ol>
<li>Check that your IAM role has <em>ses:SendRawEmail</em> action allowed (see <a href="#example-3">example #3</a>)</li>
<li>Check that the email address you are sending mail from is verified</li>
<li>There are multiple reports that access keys with special symbols might fail sending mail. Try to generate new access keys and see if it helps</li>
</ol>

<p><strong>2. aws-sdk is not found</strong></p>

<p>You need to install the <a href="https://www.npmjs.com/package/aws-sdk">aws-sdk</a> module separately, it is not bundled with Nodemailer.</p>

<h3 id="examples">Examples</h3>

<h4 id="example-1">1. Send a message using SES transport</h4>

<pre><code class="language-javascript">let nodemailer = require('nodemailer');
let aws = require('aws-sdk');

// configure AWS SDK
aws.config.loadFromPath('config.json');

// create Nodemailer SES transporter
let transporter = nodemailer.createTransport({
    SES: new aws.SES({
        apiVersion: '2010-12-01'
    })
});

// send some mail
transporter.sendMail({
    from: 'sender@example.com',
    to: 'recipient@example.com',
    subject: 'Message',
    text: 'I hope this message gets sent!',
    ses: { // optional extra arguments for SendRawEmail
        Tags: [{
            Name: 'tag name',
            Value: 'tag value'
        }]
    }
}, (err, info) =&gt; {
    console.log(info.envelope);
    console.log(info.messageId);
});
</code></pre>

<h4 id="example-2">2. Throttle messages</h4>

<pre><code class="language-javascript">let transporter = nodemailer.createTransport({
    SES: new aws.SES({
        apiVersion: '2010-12-01'
    }),
    sendingRate: 1 // max 1 messages/second
});

// Push next messages to Nodemailer
transporter.on('idle', () =&gt; {
    while (transporter.isIdle()) {
        transporter.sendMail(...);
    }
});
</code></pre>

<h4 id="example-3">3. IAM policy</h4>

<p>Nodemailer SES transport requires <em>ses:SendRawEmail</em> role</p>

<pre><code class="language-json">{
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;ses:SendRawEmail&quot;,
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}
</code></pre>


      
      </div>
    </div>

    <div id="navigation">
        
        <a class="nav nav-prev" href="/transports/sendmail/"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="/transports/stream/" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/js/jquery.sticky-kit.min.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>
    

    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51322-34', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>

